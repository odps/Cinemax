<ng-container *ngIf="!isHighlighted; else highlightedTemplate">
  <div
    class="bg-gray-900 rounded-lg overflow-hidden shadow-lg transition-transform hover:scale-105 min-w-[250px] max-w-[350px] h-[450px] flex flex-col"
  >
    <div class="h-60 overflow-hidden">
      <img
        [src]="
          assetsLocation.assetUrl + '/' + pelicula.imagenUrl ||
          assetsLocation.assetUrl + '/' + 'placeholder.jpg'
        "
        [alt]="pelicula.titulo"
        class="w-full h-full object-cover"
      />
    </div>
    <div class="p-6 flex-grow flex flex-col justify-between">
      <div>
        <h3 class="text-xl font-bold text-white mb-2">{{ pelicula.titulo }}</h3>
        <p class="text-gray-400 mb-4">
          Género: {{ pelicula.genero || "No especificado" }}
        </p>
        <p class="text-gray-400 mb-4">
          Límite de Edad: {{ pelicula.limiteEdad || "No especificado" }}
        </p>
        <p class="text-gray-400 mb-4">
          Duración: {{ pelicula.duracion || "No especificado" }} minutos
        </p>
      </div>
      <a
        class="text-yellow-400 hover:underline cursor-pointer text-sm mt-2 flex items-center gap-1 font-bold"
        (click)="mostrarDetalles()"
      >
        <i class="pi pi-info-circle"></i>
        <span>Ver detalles</span>
      </a>
    </div>
  </div>
</ng-container>

<ng-template #highlightedTemplate>
  <div
    class="bg-gray-900 rounded-lg overflow-hidden shadow-lg transition-transform hover:scale-105 sm:block lg:col-span-3"
  >
    <div class="flex flex-col lg:flex-row h-full">
      <div class="w-full lg:w-1/2 h-60 lg:h-auto overflow-hidden">
        <img
          [src]="
            assetsLocation.assetUrl + '/' + pelicula.imagenUrl ||
            assetsLocation.assetUrl + '/' + 'placeholder.jpg'
          "
          [alt]="pelicula.titulo"
          class="w-full h-full object-cover"
        />
      </div>
      <div class="p-6 lg:w-1/2 flex flex-col justify-center">
        <span class="text-yellow-500 font-semibold mb-2">DESTACADO</span>
        <h3 class="text-2xl font-bold text-white mb-4">
          {{ pelicula.titulo }}
        </h3>
        <p class="text-gray-300 mb-6">{{ pelicula.descripcion }}</p>
        <div class="mt-4 flex flex-col gap-2">
          <p-button
            label="Reservar entradas"
            icon="pi pi-ticket"
            severity="danger"
            class="mb-2"
            (click)="abrirSalasModal()"
          ></p-button>
          <a
            class="text-yellow-400 hover:underline cursor-pointer text-sm flex items-center gap-1 font-bold"
            (click)="mostrarDetalles()"
          >
            <i class="pi pi-info-circle"></i>
            <span>Ver detalles</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<p-dialog
  header="Detalles de la Película"
  [(visible)]="mostrarModal"
  [modal]="true"
  [style]="{ width: '90vw', maxWidth: '600px' }"
  contentStyle="background-color: #1a1a1a; color: #f5f5f5;"
>
  <div *ngIf="pelicula" class="flex flex-col items-center">
    <img
      [src]="
        assetsLocation.assetUrl + '/' + pelicula.imagenUrl ||
        assetsLocation.assetUrl + '/' + 'placeholder.jpg'
      "
      [alt]="pelicula.titulo"
      class="w-full max-w-xs rounded-lg shadow-md mb-5 border-2 border-yellow-400"
    />
    <h3 class="text-2xl font-extrabold text-yellow-400 mb-3 drop-shadow">
      {{ pelicula.titulo }}
    </h3>
    <div class="w-full flex flex-col gap-3 mt-2">
      <p class="text-gray-200 mb-1 font-bold">
        <span class="text-white">Género:</span>
        {{ pelicula.genero || "No especificado" }}
      </p>
      <p class="text-gray-200 mb-1 font-bold">
        <span class="text-white">Duración:</span>
        {{ pelicula.duracion || "No especificado" }} minutos
      </p>
      <p class="text-gray-200 mb-1 font-bold">
        <span class="text-white">Límite de Edad:</span>
        {{ pelicula.limiteEdad || "No especificado" }}
      </p>
      <p class="text-gray-200 mb-1 font-bold">
        <span class="text-white">Director:</span> {{ pelicula.director }}
      </p>
      <span class="text-gray-200 font-bold">Descripción:</span>
      <p
        class="text-gray-200 mb-2 text-center font-bold bg-gray-800 rounded p-2"
      >
        {{ pelicula.descripcion }}
      </p>
    </div>
    <div class="flex justify-center mt-4">
      <p-button
        label="Reservar entradas"
        icon="pi pi-ticket"
        severity="danger"
        (click)="abrirSalasModal()"
      ></p-button>
    </div>
  </div>
</p-dialog>

<p-dialog
  header="Salas y Funciones disponibles"
  [(visible)]="mostrarSalasModal"
  [modal]="true"
  [style]="{ width: '90vw', maxWidth: '600px' }"
  contentStyle="background-color: #1a1a1a; color: #f5f5f5;"
>
  <div *ngIf="pelicula && pelicula.funciones && pelicula.funciones.length > 0">
    <div
      *ngFor="let group of agruparFuncionesPorSala(pelicula.funciones)"
      class="mb-6"
    >
      <h4 class="text-lg font-bold text-yellow-300 mb-2">
        Sala: {{ group.sala?.nombre }}
      </h4>
      <ul class="space-y-2">
        <li
          *ngFor="let funcion of group.funciones"
          class="flex items-center justify-between bg-gray-800 rounded p-2"
        >
          <span>
            <i class="pi pi-calendar mr-2"></i>
            {{ funcion.fechaHora | date : "dd/MM/yyyy HH:mm" }}
            <span class="ml-4 text-gray-400"
              >Precio: {{ funcion.precio | currency : "EUR" }}</span
            >
          </span>
          <p-button
            label="Reservar"
            icon="pi pi-ticket"
            size="small"
            severity="info"
          ></p-button>
        </li>
      </ul>
    </div>
  </div>
  <div
    *ngIf="!pelicula.funciones || pelicula.funciones.length === 0"
    class="text-center text-gray-400"
  >
    No hay funciones disponibles para esta película.
  </div>
  <div class="flex justify-end mt-4">
    <p-button
      label="Cerrar"
      icon="pi pi-times"
      (click)="cerrarSalasModal()"
      [outlined]="true"
    ></p-button>
  </div>
</p-dialog>
