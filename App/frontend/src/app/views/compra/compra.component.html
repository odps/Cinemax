<div class="compra-container">
  <!-- Toast notifications -->
  <p-toast></p-toast>

  <!-- Main Content -->
  <div class="content-section">
    <!-- Header with steps -->
    <div class="header">
      <h1 class="compra-title">Compra de Tickets</h1>
      <p-steps
        [model]="steps"
        [activeIndex]="currentStep"
        [readonly]="true"
      ></p-steps>
    </div>

    <!-- Loading indicator -->
    <div class="loading-section" *ngIf="loading">
      <div class="spinner"></div>
      <p>Cargando...</p>
    </div>

    <!-- Error display -->
    <div class="error-section" *ngIf="error && !loading">
      <div class="error-message">
        <i class="pi pi-exclamation-triangle"></i>
        <p>{{ error }}</p>
        <button
          pButton
          type="button"
          label="Volver"
          icon="pi pi-arrow-left"
          (click)="onReturnToHome()"
        ></button>
      </div>
    </div>

    <!-- Step 1: Seat Selection -->
    <div class="step-section" *ngIf="!loading && !error && currentStep === 0">
      <!-- Movie and function details -->
      <app-movie-function-details
        [pelicula]="pelicula"
        [funcion]="funcion"
        [sala]="sala"
      >
      </app-movie-function-details>

      <!-- Seat selection component - with simpler approach -->
      <app-seat-map
        [funcionId]="funcionId"
        (seatSelected)="onSeatSelected($event)"
        (continueToPayment)="onContinueToPayment()"
        (cancelSelection)="onReturnToHome()"
      >
      </app-seat-map>
    </div>

    <!-- Step 2: Payment -->
    <div class="step-section" *ngIf="!loading && !error && currentStep === 1">
      <!-- Movie and function details summary -->
      <app-movie-function-details
        [pelicula]="pelicula"
        [funcion]="funcion"
        [sala]="sala"
      >
      </app-movie-function-details>

      <!-- Selected seat information -->
      <div class="selected-seat-summary" *ngIf="selectedSeat">
        <h3>Asiento seleccionado:</h3>
        <p>
          Fila {{ selectedSeat.idAsiento.fila }} - Asiento
          {{ selectedSeat.idAsiento.numero }}
        </p>
      </div>

      <!-- Payment form component -->
      <app-payment-form
        (paymentSubmitted)="onPaymentSubmitted($event)"
        (cancelPayment)="onCancelPayment()"
      >
      </app-payment-form>
    </div>

    <!-- Step 3: Confirmation -->
    <div class="step-section" *ngIf="!loading && !error && currentStep === 2">
      <!-- Ticket confirmation component -->
      <app-ticket-confirmation
        [ticket]="ticketInfo"
        [pelicula]="pelicula"
        [sala]="sala"
        (returnToHome)="onReturnToHome()"
        (goToShowtimes)="onGoToShowtimes()"
      >
      </app-ticket-confirmation>
    </div>
  </div>
</div>
